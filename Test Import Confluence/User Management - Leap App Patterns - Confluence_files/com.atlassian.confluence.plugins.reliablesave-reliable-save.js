WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.reliablesave:reliable-save', location = 'templates/reliable-save.soy' */
// This file was automatically generated from reliable-save.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Editor.Reliable.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Editor == 'undefined') { Confluence.Templates.Editor = {}; }
if (typeof Confluence.Templates.Editor.Reliable == 'undefined') { Confluence.Templates.Editor.Reliable = {}; }


Confluence.Templates.Editor.Reliable.draftMessage = function(opt_data, opt_ignored) {
  var output = '<div id="draft-messages">';
  if (opt_data.isNewPage) {
    if (opt_data.existingDraft.title) {
      var escapedTitle__soy8 = '' + soy.$$escapeHtml(opt_data.existingDraft.title);
      output += soy.$$filterNoAutoescape(AJS.format('A new page you were adding on {0} called \x26#8216;{1}\x26#8217; was saved as a draft.',opt_data.existingDraft.date,escapedTitle__soy8));
    } else {
      output += soy.$$filterNoAutoescape(AJS.format('A new page you were adding on {0} was saved as a draft.',opt_data.existingDraft.date));
    }
    output += ' ' + soy.$$filterNoAutoescape(AJS.format('Do you want to {0}resume editing{1} or {2}discard{3} it?','<a href="#" class="use-draft"> ','</a>','<a href="#" class="discard-draft"> ','</a>'));
  } else {
    output += soy.$$filterNoAutoescape(AJS.format('A version of this page you were editing at {0} was saved as a draft.',opt_data.existingDraft.date)) + ((opt_data.mergeRequired) ? ' ' + soy.$$escapeHtml('The page has since been updated. Your changes will be merged with the latest version.') : '') + ((opt_data.conflictFound) ? ' ' + soy.$$filterNoAutoescape(AJS.format('The page has since been updated. The changes made conflict with your changes and cannot be merged. Do you want to {0}view the conflict{1} or {2}discard{3} your changes?','<a href="?pageId=' + opt_data.pageId + '&viewConflict=true&spaceKey=' + opt_data.spaceKey + '" >','</a>','<a href="#" class="discard-draft">','</a>','<a href="' + "/wiki" + '/users/viewmydrafts.action">','</a>')) : (opt_data.mergeRequired) ? ' ' + soy.$$filterNoAutoescape(AJS.format('Do you want to {0}view{1}, {2}merge and resume editing{3} or {4}discard{5} it?','<a id="view-diff-link-notification" href="#" class="view-diff-link">','</a>','<a href="#" class="use-draft"> ','</a>','<a href="#" class="discard-draft">','</a>')) : ' ' + soy.$$filterNoAutoescape(AJS.format('Do you want to {0}view the change{1}, {2}resume editing{3} or {4}discard{5} it?','<a id="view-diff-link-notification" href="#" class="view-diff-link">','</a>','<a href="#" class="use-draft"> ','</a>','<a href="#" class="discard-draft">','</a>')));
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Editor.Reliable.draftMessage.soyTemplateName = 'Confluence.Templates.Editor.Reliable.draftMessage';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.reliablesave:reliable-save', location = 'js/reliable-save.js' */
define("confluence-editor-reliable-save/reliable-save","ajs confluence/templates underscore jquery window document confluence/api/constants confluence-editor/editor/page-editor-message confluence-editor/editor/page-editor-quit-dialog confluence/analytics-support confluence/legacy-editor-global-AVOID-IF-POSSIBLE confluence/meta".split(" "),function(a,m,k,d,u,I,n,c,A,q,i,b){function r(){return b.get("shared-drafts")}function s(){return b.getBoolean("new-page")}function v(b){var d="There was an error processing the request.";
c.closeMessages(["generic-error"]);c.handleMessage("generic-error",{type:"error",message:d},f);a.logError("Generic error: "+JSON.stringify(b))}function f(){var a=d("#draft-messages");if(a.length>0){a.is(":visible")&&q.publish("rte.notification.draft");a.find("a.use-draft").click(function(a){a.stopPropagation();a.preventDefault();i.Drafts.useDraft();q.publish("rte.notification.draft.resume")});a.find("a.discard-draft").click(function(a){a.stopPropagation();a.preventDefault();l.Draft.discardDraft(b.get("page-id"),
b.get("existing-draft-id")).done(l.Draft.onSuccessDiscardDraft).fail(l.Draft.onErrorDiscardDraft)})}}function F(){d("#editor-restore-title-link").click(function(a){a.stopPropagation();a.preventDefault();d("#content-title").val(b.get("latest-published-page-title"));c.closeMessages(["rename-during-limited-mode"])})}function w(b){var d="Looks like your session expired. Log in again to keep working.\n \u003cdiv\u003e\u003ca href=\"dashboard.action\" target=\"_blank\"\u003eLogin\u003c/a\u003e\u003c/div\u003e";c.closeMessages(["noauthorized"]);c.handleMessage("noauthorized",{title:"Can\'t connect to the server",
type:"error",message:d},f);b&&a.trigger("rte.safe-save.invalid-xsrf-token")}function B(){var b="Unable to communicate with server. Saving is not possible at the moment.";c.closeMessages(["server-offline"]);c.handleMessage("server-offline",{type:"error",message:b},f)}var C=[],x="confluence.editor.publish",l={Draft:{discardDraft:function(a,c){var f={draftId:c,pageId:a,type:b.get("draft-type"),spaceKey:b.get("space-key")};return d.ajax({type:"DELETE",url:n.CONTEXT_PATH+"/rest/tinymce/1/drafts/discard",data:d.toJSON(f),contentType:"application/json",
dataType:"json"})},onSuccessDiscardDraft:function(){s()||b.set("draft-id","0");c.closeMessages(["draft-message"]);c.handleMessage("discarding-successfull",{type:"info",message:"Your draft has been discarded.",close:"auto"},f);q.publish("rte.notification.draft.discard")},onErrorDiscardDraft:function(b){switch(b.status){case 403:w(true);break;case 404:c.handleMessage("draft-deleted",{type:"info",message:"This draft has been discarded."},f);break;case 422:c.handleMessage("discarding-invalid",
{type:"error",message:"This draft is invalid. It can be deleted by someone or looks like your session expired."},f);break;default:c.handleMessage("discarding-error",{type:"error",message:"An unknown error has occurred. Please check your logs."},f)}}},_internal:{}};l._internal.onSuccessfulResponse=function(c){d("#rte-button-overwrite").unbind("click.overwrite");var f={dataType:"json",contentId:b.get("content-id"),draftType:b.get("draft-type")};a.safe.post(n.CONTEXT_PATH+"/json/stopheartbeatactivity.action",f,function(){a.log("Stop heartbeat activity on",
f.draftType,"id",f.contentId)},"json").fail(function(b,c,d){a.logError("Server error on stop heartbeat activity request:");a.log(d)}).always(function(){var a=c._links.webui;a?u.location=a.indexOf("/")!==0?a:n.CONTEXT_PATH+a:i.UI.toggleSavebarBusy(false)})};l.initialize=function(){function t(e){function E(b){a.trigger("rte.safe-save.error",{status:b.status})}a.trigger("synchrony.stop",{id:x});e&&e.preventDefault();var j=d("#content-title");if(j.hasClass("placeholded")||j.val().trim()===""){a.trigger("rte.safe-save.error");
a.trigger("synchrony.start",{id:x});c.closeMessages(["title-too-long","duplicate-title"]);c.handleMessage("empty-title",{title:"This page needs a name",type:"error",message:"Add a page title before hitting publish."},f);i.UI.toggleSavebarBusy(false)}else{i.Drafts.unBindUnloadMessage();var g={},h=b.get("draft-id"),o=b.get("content-id"),e=n.CONTEXT_PATH+"/rest/api/content",m=d("#sourceTemplateId").val();g.status="current";g.title=j.val();g.space={key:b.get("space-key")};var k=a.Rte.getEditor().getContent();
C.forEach(function(a){k=a(k)});g.body={editor:{value:k,representation:"editor"}};if(m)g.extensions={sourceTemplateId:m};j=(j=i.UI.postingDatePicker)&&j.getDate();if(D.type==="blogpost"&&j&&j.toISOString)g.history={createdDate:j.toISOString()};if(s()&&!b.get("shared-drafts")){j="POST";b.get("is-blueprint-page")&&(e=e+"/blueprint/instance/"+h);e=e+"?status=draft";g.id=h;g.type=b.get("content-type");g.body.editor.content={id:h}}else{j="PUT";s()&&b.get("is-blueprint-page")&&(e=e+"/blueprint/instance");
e=e+"/"+o;if(s()&&r()){g.id=h;g.body.editor.content={id:h}}else{g.id=b.get("page-id");g.body.editor.content={id:b.get("page-id")}}e=h==="0"?e+"?status=current":e+"?status=draft";h=b.getNumber("page-version")||0;g.type=b.get("content-type");g.version={number:h+1,message:d("#versionComment").val(),minorEdit:d("#notifyWatchers").is(":checked")?false:true,syncRev:d("#syncRev").val()}}h={};h.id=b.get("parent-page-id")||"0";h.type=b.get("content-type");o=b.get("parent-page-id");if(!o||g.space.key!==b.get("space-key"))h.id=
"0";if(o&&h.id!==o)h.id=d("#parentPageString").val()===b.get("from-page-title")?h.id:o;if(h.id!=="0")g.ancestors=[h];d.ajax({type:j,url:e,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(g),success:function(b){(g.type==="page"||g.type==="blogpost")&&a.trigger("analytics",{name:"confluence.editor.close",data:{source:"publishButton"}});a.trigger("rte.safe-save.success",b);l._internal.onSuccessfulResponse(b)},error:function(e){var h=false;i.UI.toggleSavebarBusy(false);
switch(e.status){case 400:c.closeMessages(["empty-title","duplicate-title","title-too-long","legacy-draft-deprecated"]);if(e.responseText.indexOf(p.duplicatedTitle)>=0)c.handleMessage("duplicate-title",{type:"error",message:a.format("A page with the title \'\'{0}\'\' already exists in this space. Enter a different title for your page.",a.escapeHtml(d("#content-title").val()))});else if(e.responseText.indexOf(p.titleTooLong)>=0)c.handleMessage("title-too-long",{type:"error",message:"Title cannot be longer than 255 characters."},f);else if(e.responseText.indexOf(p.publishNewDraftDeprecated)>=
0||e.responseText.indexOf(p.existingDraftNotFound)>=0)if(b.get("new-page")&&r()&&!i.hasContentChanged()){a.trigger("rte.legacy-draft-can-be-migrated");c.handleMessage("legacy-draft-deprecated",{type:"error",message:a.format("Collaborative editing is here! So that you can keep working on this page, we need to migrate the content to a new draft for you.\u003cbr\u003e \u003ca href={0}\u003eMigrate now\u003c/a\u003e",n.CONTEXT_PATH+"/pages/resumedraft.action?draftId="+b.get("draft-id"))},f)}else{a.trigger("rte.legacy-draft-cannot-be-migrated");c.handleMessage("legacy-draft-deprecated",{type:"error",message:"Collaborative editing is here! That means we need a little help from you to restart your editing session. All you need to do is copy the content, edit this page again, then paste it in and save."},
f)}else v(e);break;case 403:w(true);break;case 404:c.closeMessages(["page-not-accessible","noauthorized"]);c.handleMessage("page-not-accessible",{title:"This content cannot be accessed.",type:"error",message:a.format("Your session may have expired, you can attempt to \u003ca href=\"dashboard.action\" target=\"_blank\"\u003elog in\u003c/a\u003e.",g.space.key)},f);break;case 409:if(r()){h=true;if(y<G){y++;z.push(setTimeout(function(){t()},H))}else{a.trigger("analyticsEvent",{name:"editor.save.error.conflict"});y=0;c.handleMessage("page-conflict",{title:"Can\'t sync with the server.",
type:"error",message:a.format("Refresh the page to try to re-establish the connection.",g.space.key)},f);E(e)}}else{i.restoreDefaultSave();i.UI.saveButton.click()}break;case 410:c.closeMessages(["page-deleted"]);c.handleMessage("page-deleted",{title:"This content has been deleted",type:"error",message:a.format("Copy your content, then add it to a new page or \u003cdiv\u003e\u003ca href=\"viewtrash.action?key={0}\" target=\"_blank\"\u003erestore this page from the trash\u003c/a\u003e and try again.\u003c/div\u003e",g.space.key)},f);break;case 413:c.closeMessages(["page-too-big"]);c.handleMessage("page-too-big",{type:"error",message:"This page is too big to save. You could split it into multiple pages, then use the \u003ca href=\"https://confluence.atlassian.com/conf51/include-page-macro-336169384.html\" target=\"_blank\"\u003einclude page macro\u003c/a\u003e to display the content."},
f);break;case 0:case 500:case 503:for(;z.length;)clearTimeout(z.shift());B();break;case 501:e.responseText.indexOf(p.renameDuringLimitedMode)>=0?c.handleMessage("rename-during-limited-mode",{type:"error",message:"Changing page titles isn\'t possible right now, as collaborative editing is offline. \u003cdiv\u003e\u003ca id=\"editor-restore-title-link\" href=\"#\"\u003eRestore the page title\u003c/a\u003e if you\'d like to publish the page.\u003c/div\u003e"},F):v(e);break;default:v(e)}h||E(e);a.trigger("synchrony.start",{id:x})}})}}if(!(d("#editpageform").length===0&&d("#createpageform").length===0)){var p={duplicatedTitle:"A page with this title already exists",titleTooLong:"Title cannot be longer than 255 characters.",
publishNewDraftDeprecated:"Unsupported call to publishNewDraft",existingDraftNotFound:"Could not find existing draft, perhaps you're trying to publish a personal draft?",renameDuringLimitedMode:"Unable to perform a page rename when limited mode is enabled"},D={existingDraftId:b.get("existing-draft-id")?b.get("existing-draft-id"):0,pageId:b.get("page-id"),type:b.get("draft-type"),spaceKey:b.get("space-key")};if(b.get("show-draft-message")===true){if(d("#conflict-diffs").length>0)return;d.ajax({type:"GET",
url:n.CONTEXT_PATH+"/rest/tinymce/1/drafts/message",data:D,contentType:"application/json",dataType:"text json",success:function(a){if(a&&a.draftData){a=m.Editor.Reliable.draftMessage({existingDraft:a.draftData,conflictFound:a.conflictFound,mergeRequired:a.mergeRequired,isNewPage:a.newPage,pageId:b.get("page-id"),spaceKey:b.get("space-key")});c.handleMessage("draft-message",{type:"info",message:a},f)}}})}var u=d("#editor-notifications-container #all-messages .aui-message-error").length>0;if(r()){A.init({saveHandler:t});
i.overrideSave(A.process)}else u?i.restoreDefaultSave():i.overrideSave(t);d("#rte-button-overwrite").bind("click.overwrite",function(a){q.publish("confluence.editor.legacy.draft.conflict",{action:"clickOverwrite"});t(a)});var y=0,G=3,H=1E3,z=[];a.bind("rte.heartbeat-error",function(b,d){switch(d.status){case 401:case 403:c.isDisplayed(["page-not-accessible"])||w(false);break;case 0:case 404:case 500:case 503:i.metadataSyncRequired()||B();break;default:a.logError("Heartbeat action error: "+JSON.stringify(d))}});
a.bind("rte.heartbeat",function(){var b=false;k.each(c.displayedErrors(),function(a){if(k.contains(["noauthorized","server-offline","page-not-accessible"],a)){b=true;c.closeMessages([a])}});b&&c.handleMessage("reconnect",{type:"info",title:"Successfully reconnected",message:"We\'re back in business. You\'re free to save your page again.",close:"auto"},f)})}};l.registerCleanupFunction=function(a){C.push(a)};return l});
require("confluence/module-exporter").safeRequire("confluence-editor-reliable-save/reliable-save",function(a){var m=require("ajs"),k=require("confluence/meta"),d=0<window.document.referrer.indexOf("createDialog=true&flashId");m.DarkFeatures.isEnabled("editor.ajax.save")&&!(""===k.get("remote-user")||d)&&m.bind("rte.init.ui",function(){a.initialize();Confluence.Editor=Confluence.Editor||{};Confluence.Editor.SafeSave=Confluence.Editor.SafeSave||{};Confluence.Editor.SafeSave.Draft=a.Draft;Confluence.Editor.SafeSave._internal=
a._internal||{}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.reliablesave:reliable-save', location = 'js/ajax-login.js' */
define("confluence-editor-reliable-save/ajax-login",["confluence/dark-features","confluence/meta","ajs","jquery","document"],function(d,c,f,g,u){return function(){function v(c,j){var a=q.call(g,c,j),d=c&&c.url;if(r&&(!j||j&&!j.preventAjaxLogin)&&d&&(l&&0===d.indexOf(l)||k&&0===d.indexOf(k))){var t=function(a,d,w,l){function k(){b.readyState=a.readyState;b.status=a.status;b.statusText=a.statusText;a.responseXML?b.responseXML=a.responseXML:b.responseText=a.responseText;d.apply(w,l)}var n=a.getResponseHeader("X-AUSERNAME");
r===n?k():(m.push({deferred:e,url:c,settings:j,defaultCallback:k}),o||(p=!1,h||(h=new f.Dialog(840,700),h.addPanel("ajax-login","ajax-login-content","ajax-login-panel",1),n=g(".ajax-login-panel"),i=g("<iframe></iframe>"),i.bind("load",function(){var a=i[0].contentDocument.location.pathname;a&&0<=a.indexOf("/"+s)&&(o=!1,p=!0,h.hide(),i.attr("src","about:blank"))}),n.append(i),g(u).bind("hideLayer",function(a,b,d){if("popup"===b&&d===h.popup){f.debug("hiding login dialog");if(p){a=m;b=0;for(d=a.length;b<
d;b++){var c=a[b];f.debug("Rerunning ajax query to: "+c.url,c);q.call(g,c.url,c.settings).done(function(){f.debug("Rerunning done");c.deferred.resolve(arguments)}).fail(function(){f.debug("Rerunning failed");c.deferred.reject(arguments)})}}else{a=m;b=0;for(d=a.length;b<d;b++){var e=a[b];f.debug("Executing with original response for: "+e.url,e);e.defaultCallback&&e.defaultCallback()}}m=[]}})),i.attr("src",x),h.show(),o=!0))};f.debug("Using authenticatingPromise");var b={abort:function(){a.abort.apply(a,
arguments)},getAllResponseHeaders:function(){a.getAllResponseHeaders.apply(a,arguments)},getResponseHeader:function(){a.getResponseHeader.apply(a,arguments)},overrideMimeType:function(){a.overrideMimeType.apply(a,arguments)},readyState:a.readyState,setRequestHeader:function(b,c){a.setRequestHeader.apply(a,arguments)},state:function(){a.state.apply(a,arguments)},status:a.status,statusCode:function(){a.statusCode.apply(a,arguments)},statusText:a.statusText},e=g.Deferred();e.promise(b);b.success=b.done;
b.error=b.fail;a.done(function(a,b,c){t(c,e.resolve,e,arguments)});a.fail(function(a,b,c){t(a,e.reject,e,arguments)});return b}return a}if(d.isEnabled("ajax.login")){f.debug("AJAX login support enabled");var o=!1,h,i,p,m=[],q=g.ajax,r=c.get("remote-user"),l=c.get("base-url"),k=c.get("context-path"),s="ajaxlogincomplete.action",x=c.get("context-path")+"/login.action?os_destination=%2F"+s;g.ajax=v}}});require("confluence/module-exporter").safeRequire("confluence-editor-reliable-save/ajax-login",function(d){require("ajs").toInit(d)});
}catch(e){WRMCB(e)};