WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-quit-dialog', location = 'editor/page-editor-quit-dialog.js' */
define("confluence-editor/editor/page-editor-quit-dialog","jquery confluence/templates ajs confluence/meta window document confluence-editor/editor/page-editor-message confluence/api/constants underscore confluence/legacy-editor-global-AVOID-IF-POSSIBLE".split(" "),function(e,l,c,g,v,G,m,w,x,d){function y(b){b.stopPropagation();b.preventDefault();c.trigger("analyticsEvent",{name:"confluence.synchrony.editor.quit-dialog.show-diff-clicked"});a.showDiffButton.hide();a.hideDiffButton.show();r()}function z(b){b.stopPropagation();
b.preventDefault();c.trigger("analyticsEvent",{name:"confluence.synchrony.editor.quit-dialog.hide-diff-clicked"});a.hideDiffButton.hide();a.showDiffButton.show();a.dialogEl.removeClass("aui-dialog2-xlarge").addClass("aui-dialog2-medium");j(n)}function A(b){c.trigger("analyticsEvent",{name:"confluence.synchrony.editor.quit-dialog.discard"});b.stopPropagation();b.preventDefault();d.UI.setButtonsState(false,a.buttonsAll);var h=g.get("content-id"),b=c.contextPath(),b=f?b+"/rest/synchrony/1.0/content/"+
h+"/changes/unpublished":b+"/rest/api/content/"+h+"?status=draft";f&&m.suppressMessage("editor.synchrony.revert-page");e.ajax({url:b,type:"DELETE",data:{draftId:h},contentType:"application/json",dataType:"json"}).done(function(){f&&m.handleMessage("collaborative-editor-discard-error",{type:"success",close:"auto",message:"Successfully reverted to the last published version"});c.trigger("analyticsEvent",{name:"confluence.synchrony.editor.quit-dialog.discard-success",data:{contentId:h}});s()}).fail(function(b){m.handleMessage("collaborative-editor-discard-error",
{type:"error",title:f?"Can\'t revert to last published version":"There were errors discarding your draft.",message:f?"We can\'t get the last published version of the page at the moment. Give it a few moments then try discarding the draft again.":b.errors||"An unknown error has occurred. Please check your logs."});c.trigger("analyticsEvent",{name:"confluence.synchrony.editor.quit-dialog.discard-error",data:{contentId:h}});d.UI.setButtonsState(true,a.buttonsAll)})}function s(){a.editorForm.append(l.Editor.Page.hiddenInputCancel()).submit()}function t(a){if(a){a.stopPropagation();
a.preventDefault()}s()}function B(b){d.UI.setButtonsState(false,a.buttonsAll);o.save(b)}function C(b){b.stopPropagation();b.preventDefault();c.trigger("analyticsEvent",{name:"confluence.synchrony.editor.draft-status-indicator.click"});p(function(){a.closeButton.show();r()})}function D(b){b.stopPropagation();b.preventDefault();a.dialog.hide()}function r(){a.dialogEl.removeClass("aui-dialog2-medium").addClass("aui-dialog2-xlarge");j(i.SHOW_DIFF);e.ajax({url:w.CONTEXT_PATH+"/rest/tinymce/1/content/"+
g.get("page-id")+"/draft/diff",type:"GET"}).success(function(b){a.dialogContent.find(".wiki-content").html(b).children().first().hasClass("diff-context-placeholder")&&a.dialogContent.find("hr").hide()})}function j(b){a.dialogHeader.html(l.Editor.Page.quitDialogHeader({dialogType:b}));a.dialogContent.html(l.Editor.Page.quitDialogContent({dialogType:b,contributors:k}));a.dialogFooter.find("."+b).show();a.dialog.show()}function E(){c.trigger("analyticsEvent",{name:"confluence.synchrony.editor.quit-dialog.dialog-closed"});
a.dialogEl.removeClass("aui-dialog2-xlarge").addClass("aui-dialog2-medium");d.UI.toggleSavebarBusy(false);a.dialogFooter.find(".aui-button").hide();a.dialogContent.empty()}function F(a,c){c&&c.contributors&&(k=x.reject(c.contributors,function(a){return a.name===g.get("remote-user")}))}function p(a){d.Drafts.save({forceSave:f,skipErrorHandler:true,onSuccessHandler:a||e.noop})}var a={},f,u,i={EXIT:"exit",PUBLISH:"publish",SHOW_DIFF:"diff"},k=[],q=false,o={},n;return{init:function(b){if(u=g.getBoolean("shared-drafts")&&
(g.get("content-type")==="page"||g.get("content-type")==="blogpost"))if(q){o.save=b.saveHandler;a.publishButton.click(B)}else{f=!g.get("new-page");a.discardButton=e("#qed-discard-button").tooltip({gravity:"s",className:"quit-editor-dialog"});if(d.isLimitedModeEnabled()&&f){d.UI.setButtonState(false,a.discardButton);a.discardButton.removeAttr("disabled")}else a.discardButton.click(A);a.saveExitButton=e("#qed-save-exit-button").click(t);a.showDiffButton=e("#qed-show-diff-button").click(y);a.hideDiffButton=
e("#qed-hide-diff-button").click(z);a.publishButton=e("#qed-publish-button");a.closeButton=e("#qed-close-button").click(D);a.buttonsAll=[a.discardButton,a.saveExitButton,a.showDiffButton,a.hideDiffButton,a.publishButton];a.dialog=c.dialog2("#quit-editor-dialog");a.dialogEl=a.dialog.$el;a.dialogHeader=a.dialogEl.find(".aui-dialog2-header");a.dialogContent=a.dialogEl.find(".aui-dialog2-content");a.dialogFooter=a.dialogEl.find(".aui-dialog2-footer");a.editorForm=e("#wysiwyg").closest("form");e("#pluggable-status").on("click",
"a",C);a.dialog.on("hide",E);c.bind("editor-heartbeat",F);q=true}},process:function(b){if(u){b.stopPropagation();b.preventDefault();e(v).one("editor-heartbeat",function(){switch(b.target.id){case d.UI.saveButton.attr("id"):case d.UI.versionCommentInput.attr("id"):d.UI.toggleSavebarBusy(true);if(k.length===0)o.save();else{p();f&&a.showDiffButton.show();j(i.PUBLISH);n=i.PUBLISH}break;case d.UI.cancelButton.attr("id"):if(d.Drafts.isDraftDirty()){p();f&&a.showDiffButton.show();d.UI.toggleSavebarBusy(true);
k.length===0?a.discardButton.html("Discard \u003cstrong\u003eall\u003c/strong\u003e changes"):a.discardButton.html("Discard \u003cstrong\u003eeveryone\'s\u003c/strong\u003e changes");j(i.EXIT);n=i.EXIT}else t()}});d.heartbeat()}},_destroy:function(){q=false}}});
}catch(e){WRMCB(e)};