WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:import-subcalendar', location = 'com/atlassian/confluence/extra/calendar3/components/import-subcalendar/import-subcalendar.soy' */
// This file was automatically generated from import-subcalendar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.TeamCalendars.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.importSubcalendar = function(opt_data, opt_ignored) {
  return '<div class="aui-message error calendar-error hidden"><p class="title"><span class="aui-icon icon-error"></span><strong>' + soy.$$escapeHtml('Error(s) occurred.') + '</strong></p><div class="error-content"><ul class="error-messages hidden"></ul></div></div><div class="aui-message warning tc-need-timezone hidden"><p class="title"><span class="aui-icon icon-warning"></span><strong>' + soy.$$escapeHtml('Unable to determine calendar timezone') + '</strong></p><p>' + soy.$$escapeHtml('The timezone for this calendar could not be determined. Please set the timezone below.') + '</p></div><form name="importSubCalendarForm" class="sub-calendar-import-form aui" method="POST" action="' + soy.$$escapeHtml("/wiki") + '/plugins/calendar/importsubcalendar.action" enctype="multipart/form-data" target="import-iframe-sink"><input type="hidden" name="calendarId" value=""><input type="hidden" name="decorator" value="none"><input type="hidden" name="color" value=""><input type="hidden" name="spaceKey" value=""><div class="field-group"><label for="import-name">' + soy.$$escapeHtml('Name') + '<span class="aui-icon icon-required"></span></label><input name="name" id="import-name"  type="text" class="text" value="" autocomplete="off"><div class="description">' + soy.$$escapeHtml('Leave this blank to use the calendar\x27s name from the ICS file.') + '</div><div class="error name-error"></div></div><div class="field-group"><label for="import-description">' + soy.$$escapeHtml('Description') + '</label><textarea name="description" id="import-description" rows="4" class="textarea"></textarea></div><div class="field-group field-group-space-permission"><label for="spaceKeyAutocomplete">' + soy.$$escapeHtml('Linked space') + '<span class="aui-icon icon-required"></span></label><input name="spaceKeyAutocomplete" id="spaceKeyAutocomplete" type="text" class="autocomplete-space text" data-max="5" data-none-message="' + soy.$$escapeHtml('No spaces found') + '"><div class="description">' + soy.$$escapeHtml('Link this calendar to a space.') + '</div><div class="error spaceKeyAutocomplete-error"></div></div><div class="field-group"><label for="ical-file">' + soy.$$escapeHtml('Upload iCal') + '<span class="aui-icon icon-required"></span></label><input type="file" class="file upfile" name="file_0" size="25"><div class="error file_0-error"></div></div><div class="field-group tc-field-group-timezone hidden"><label for="timeZone">' + soy.$$escapeHtml('Time zone') + '<span class="aui-icon icon-required"></span></label><select name="timeZoneId" class="select timeZone"></select><span class="spinner aui-icon aui-icon-wait"></span><div class="error timeZoneId-error"></div></div><iframe class="subcalendar-import-result hidden" name="import-iframe-sink" src="' + soy.$$escapeHtml("/wiki") + '/fourohfour.action"></iframe></form>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.importSubcalendar.soyTemplateName = 'Confluence.TeamCalendars.Templates.importSubcalendar';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:import-subcalendar', location = 'com/atlassian/confluence/extra/calendar3/components/import-subcalendar/import-subcalendar.js' */
define("tc/import-subcalendar",["jquery","underscore","tc/util","tc-backbone","tc/templates","tc/calendar-util"],function(e,a,f,g,c,b){var d=g.View.extend({dialog:null,$uploadIframe:null,$submitButton:null,options:null,template:c.importSubcalendar(),events:{"selected.autocomplete-content input[name='spaceKeyAutocomplete']":"_selectSpace","submit .sub-calendar-import-form":"_submit"},defaults:{callbackHandler:null,textTitleDialog:"Import calendar",textBtnImport:"Import",textLinkCancel:"Cancel"},initialize:function(h){this.options=e.extend({},this.defaults,h);if(!this.options.callbackHandler){AJS.debug("tc/import-subcalendar: requires 'callbackHandler' object")}},render:function(){this._createSubCalendarImportDialog();this._populateSubCalendarImportForm();this.$submitButton=this.dialog.popup.element.find(".submit");return this.dialog},_createSubCalendarImportDialog:function(){var h=this,i=function(){var j=h.$el.find("form.sub-calendar-import-form");j.submit();return false};if(this.dialog){return}this.dialog=new AJS.ConfluenceDialog({height:429,width:512,onSubmit:i,id:"import-calendar-dialog"});this.dialog.addHeader(this.options.textTitleDialog);this.dialog.addPanel("",this.template,"calendar-dialog-panel");this.dialog.addButton(this.options.textBtnImport,i,"submit");this.dialog.addLink(this.options.textLinkCancel,a.bind(this._cancelDialog,this));this.el=this.dialog.getCurrentPanel().body;this.$el=e(this.el);this.$uploadIframe=this.$el.find(".subcalendar-import-result");this.delegateEvents();this.$el.find(".subcalendar-import-result").load(a.bind(this._loadedResultImport,this))},_populateSubCalendarImportForm:function(){this.$el.find("input[name='name'], textarea[name='description'], input[name='spaceKey'], input[name='spaceKeyAutocomplete']").val("");this.$el.find("input[name='color']").val(this.options.callbackHandler.getNextCalendarColor());this.$el.find(".field-group .error").empty();if(AJS.Meta.get("space-key")){this.$el.find("input[name='spaceKey']").val(AJS.Meta.get("space-key"));var h=e(".field-group-space-permission",this.$el);h.css("display","none")}},_submit:function(){this.options.callbackHandler.setProcessingSubCalendar(true);this.spinnerDefer=this.options.callbackHandler.setSubCalendarSpinnerIconVisible(true);this.$uploadIframe.data("activated",true);b.disableButton(this.$submitButton,"Importing...")},_selectSpace:function(i,h){this.$el.find("input[name='spaceKey']").val(h.content.key);this.$el.find("input[name='spaceKeyAutocomplete']").val(h.content.name)},_cancelDialog:function(){this.dialog.remove();this.dialog=null;return false},_loadedResultImport:function(){var j=this;if(!this.$uploadIframe.data("activated")){return}var l=this.$uploadIframe[0].contentWindow||this.$uploadIframe[0].contentDocument;l=l.document?l.document:l;var i=e(l).find(".subcalendar-id").text();if(e(".import-timezone-required",l).length){b.disableButton(this.$submitButton);j.$el.find(".tc-need-timezone").show();j.$el.find(".tc-field-group-timezone").show();Confluence.TeamCalendars.populateTimeZoneDropDown(j.$el.find(".tc-field-group-timezone .timeZone"),Confluence.TeamCalendars.getUserTimeZone(),function(){b.enableButton(j.$submitButton,"Import")},function(m,o,n){j.options.callbackHandler.showAjaxError(m,o,n)});j.dialog.updateHeight()}else{if(!e(".import-successful",l).length){var h=[];e(".field-errors input",l).each(function(){h.push({field:this.name,errorMessages:[this.value]})});if(h.length){Confluence.TeamCalendars.setFieldErrors(j.$el.find(".sub-calendar-import-form")[0],h);j.dialog.updateHeight()}var k=[];e(".action-error",l).each(function(){k.push(e(this).text())});if(k.length){Confluence.TeamCalendars.setGenericErrors(j.el,k,"error-subcalendar-update")}}else{j.dialog.remove();j.options.callbackHandler.handleImport(i)}}b.enableButton(this.$submitButton,"Import");if(this.spinnerDefer){this.spinnerDefer.resolve()}j.options.callbackHandler.setProcessingSubCalendar(false)}});return d});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:import-subcalendar', location = 'com/atlassian/confluence/extra/calendar3/components/import-subcalendar/import-subcalendar-compat.js' */
require(["tc/import-subcalendar"],function(a){if(!Confluence.TeamCalendars.Dialogs){Confluence.TeamCalendars.Dialogs={}}Confluence.TeamCalendars.Dialogs.getSubCalendarImportDialog=function(b){return new a({callbackHandler:b}).render()}});
}catch(e){WRMCB(e)};