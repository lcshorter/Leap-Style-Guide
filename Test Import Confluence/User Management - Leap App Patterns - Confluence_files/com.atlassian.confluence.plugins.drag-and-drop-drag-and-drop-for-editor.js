WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drag-and-drop-for-editor', location = 'js/editor.js' */
define("confluence-drag-and-drop/editor","ajs jquery conf/confluence-drag-and-drop/analytics/files-upload-analytics conf/confluence-drag-and-drop/drag-and-drop-overlay document confluence-drag-and-drop/files-uploader-factory plupload underscore".split(" "),function(a,f,r,s,n,t,k,i){var e,l=t.get(),o=function(a,b,f){if(!b)return false;if(b.generalError){i.each(b.generalError.fileIds,function(d){e.renderError(d,b.generalError.message);(d=a.getFile(d))&&a.removeFile(d)});return true}if(b.fileErrors){i.each(b.fileErrors,
function(d){e.renderError(d.id,d.message);(d=a.getFile(d.id))&&a.removeFile(d)});return b.fileErrors.length===f.length}},p=function(f){if(!f.total.queued){f.stop();e.showCloseButton();e.hasErrors()||setTimeout(function(){e.hide();e.clearRenderOutput();a.Rte.BookmarkManager.restoreBookmark()},1E3)}},q=false;return function(){var m=a.Rte.getEditor().getBody().parentNode,b;b=n.getElementById("fileuploadShim");var j=false;if(!b){b=n.createElement("div");b.setAttribute("id","fileuploadShim");n.body.appendChild(b)}var d=
new k.Uploader({runtimes:"html5",dragdrop:true,drop_element:m,browse_button:b.getAttribute("id"),multipart:false,max_file_size:+a.Meta.get("global-settings-attachment-max-size")});e||(e=new a.DragAndDropProgressDialog);d.init();var i={};d.bind("Started",function(a,c){r.triggerEvent("confluence.editor.files.drag-and-drop",c)});d.bind("FilesAdded",function(b,c){function f(c,b){for(var h=0;h<b.length;h++){var g=b[h];g.status!==k.FAILED?e.render({workId:g.id,status:g.status,file:g}):c.removeFile(g)}l.filesAdded(c,
b,i).then(function(g){g=o(c,g,b);e.show();if(g)e.showCloseButton();else{e.cancelListeners.push(function(b,d){var g=c.getFile(d.workId);g&&c.removeFile(g);e.renderInfo(d.workId,"File was manually removed from the queue.")});d.start()}})}if(a.Meta.get("content-type")==="template"){b.stop();if(!q){var h=new a.Dialog(450,180);h.addHeader("Not Supported");h.addSubmit("Ok",function(){h.remove()});h.addPanel("Panel 1",
"panel1");h.getCurrentPanel().html("\u003cp\u003eAttachments are not supported in Templates.\u003c/p\u003e \u003cp\u003eFiles may be attached to a Page, and added as an image via the Insert menu.\u003c/p\u003e");h.show();q=true}}else a.UploadUtils.filterFiles(b,c,f)});d.bind("BeforeUpload",function(a,c){l.beforeUpload(a,c,i)});d.bind("UploadProgress",function(a,c){e.renderUpdateToBytesUploaded(c.id,c.loaded,c.size);e.hideCloseButton()});f.browser.mozilla&&k.addEvent(m,"dragenter",function(a){j=a.rangeParent&&a.rangeOffset!=void 0?{startElement:a.rangeParent,startOffset:a.rangeOffset}:false});d.bind("FileUploaded",function(b,
c,u){l.fileUploaded(b,c,u,true).done(function(b){j&&f(j.startElement.parentNode).closest('[contenteditable="true"]',m).length&&tinymce.activeEditor.selection.setCursorLocation(j.startElement,j.startOffset);b.htmlForEditor.substr(0,4)==="<img"?tinymce.confluence.ImageUtils.insertImagePlaceholder(b.htmlForEditor):a.Rte.getEditor().execCommand("mceInsertContent",false,b.htmlForEditor,{skip_focus:true});e.renderComplete(c.id)}).fail(function(a){o(b,a,[c])}).always(function(){p(d)})});d.bind("Error",function(b,
c){var f;if(c.response){f=l.serverError(c.response)||c.message;e.renderError(c.file.id,f);a.trigger("analyticsEvent",{name:"confluence.editor.upload.error.server-unknown"})}else{f=c.message;if(c.code===k.FILE_SIZE_ERROR){f=a.format("is too big to upload. Files must be less than {0}.",a.DragAndDropUtils.niceSize(a.Meta.get("global-settings-attachment-max-size")));a.trigger("analyticsEvent",{name:"confluence.editor.upload.error.file-size"})}else if(c.code===a.UploadUtils.ErrorCode.FILE_IS_A_FOLDER_ERROR){f="might be a folder or an unsupported file type.";
a.trigger("analyticsEvent",{name:"confluence.editor.upload.error.file-type"})}e.render({workId:c.file.id,status:c.file.status,file:c.file,errorMessage:f});if(!e.isVisible()){e.show();e.showCloseButton()}}p(d)});b={instance:d,uploadProgressDialog:e};s.bindFileDragOverlay({$dragZone:f(m).add("#toolbar ~ #editor-precursor"),$overlayZone:f("#rte"),isTransparent:true});return b}});
require("confluence/module-exporter").safeRequire("confluence-drag-and-drop/editor",function(a){AJS.toInit(function(){AJS.Rte.BootstrapManager.addOnInitCallback(function(){var f=a();AJS.Confluence.Uploader=f.instance;AJS.Confluence.EditorUploadProgressDialog=f.uploadProgressDialog})})});
}catch(e){WRMCB(e)};