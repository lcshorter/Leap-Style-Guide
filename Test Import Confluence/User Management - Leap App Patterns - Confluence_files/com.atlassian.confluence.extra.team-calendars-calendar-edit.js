WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-edit', location = 'com/atlassian/confluence/extra/calendar3/components/calendar-restriction-dialog/calendar-restrictons-dialog.js' */
define("tc/calendar-restriction-dialog",["jquery","underscore","tc-backbone","tc/templates","tc/calendar-util"],function(e,a,f,c,b){var d=f.View.extend({restrictionDialog:null,calendarDiv:null,subCalendar:null,calendarPlugin:null,calendarCache:null,editDialog:null,initialize:function(g){this.calendarDiv=g.calendarDiv;this.subCalendar=g.subCalendar;this.calendarPlugin=g.calendarPlugin;this.calendarCache=g.calendarCache;this.editDialog=g.editDialog;this.$el.html(c.restrictSubCalendar({elementIdSuffix:this.calendarPlugin.getParameter(this.calendarDiv,"elementIdSuffix"),pdlEnabled:b.isPDLEnabled()}));this.editDialog.addPanel("Restrictions",this.$el,"setup-calendar-panel")},render:function(){var h=this;this.editDialog.getCurrentPanel().onselect=function(){e("#edit-calendar-dialog").find(".button-panel-button.submit").removeClass("hidden")};var g=e("form",h.editDialog.getCurrentPanel().body);e("input[name='subCalendarId']",g).val(h.subCalendar.id||"");e(".field-group-permissions",g).each(function(){var i=e(this);e(".permissions-details",i).each(function(k){var l=e(this);var j=e(".autocomplete-user",i);j.bind("selected.autocomplete-user",function(n,m){h._addUsersToPermissionFieldGroup(i,{id:m.content.userKey||m.content.username,name:m.content.username,fullName:m.content.title,avatarUrl:m.content.thumbnailLink.href},true);j.val("")}).focus(function(){if(j.hasClass("with-hint")){j.removeClass("with-hint").val("")}}).blur(function(){if(!j.val()){j.addClass("with-hint").val("Enter user name")}}).keydown(function(m){if(m.keyCode===13&&!e(".autocomplete .aui-dropdown .active").length){setTimeout(function(){var n=j.val();if(n){h._addGroupsToPermissionFieldGroup(i,n.split(","),true,true);j.val("")}else{h.submitRestrictionsDialog(h.editDialog)}},300);e(".autocomplete .aui-dropdown .no-results").trigger("click");return false}});e(".group-picker-trigger",l).click(function(){var m="Team_Calendars_group_picker_callback_"+h.calendarPlugin.getParameter(h.calendarDiv,"elementIdSuffix")+"_"+k;window[m]=function(n){h._addGroupsToPermissionFieldGroup(i,n.split(","),false,true)};window.open(h.calendarPlugin.getParameter(h.calendarDiv,"baseUrl")+"/spaces/opengrouppicker.action?key=ds&startIndex=0&actionName=dosearchgroups.action&onPopupSubmit="+encodeURIComponent(m),m,"dependent=1,height=512,width=384,resizable=1,status=0").focus();return false})})});e(".field-group-permissions",g).each(function(){var j=e(this);var k=e(".option-view-restrictions",j);var i=e(".option-edit-restrictions",j);h._addUsersToPermissionFieldGroup(j,h.subCalendar.usersPermittedToEdit||[]);h._addGroupsToPermissionFieldGroup(j,h.subCalendar.groupsPermittedToEdit||[]);i.removeAttr("checked");k.attr("checked","checked");h._addUsersToPermissionFieldGroup(j,h.subCalendar.usersPermittedToView||[]);h._addGroupsToPermissionFieldGroup(j,h.subCalendar.groupsPermittedToView||[])});return h.editDialog},submitRestrictionsDialog:function(k){var l=this;var o=e("form",k.getCurrentPanel().body);var j=function(p){return e.map(e(".permitted-entity",p),function(r){var q=e(r).data("entity");return e.isPlainObject(q)?q.id:null})};var i=function(p){return e.map(e(".permitted-entity",p),function(r){var q=e(r).data("entity");return typeof q==="string"?q:null})};var h={subCalendarId:e("input[name='subCalendarId']",o).val()};b.putCalendarContextParams(h);var m=e(".view-permissions",o);if(m.length){h.updateUsersPermittedToView=true;h.usersPermittedToView=j(m);if(!h.usersPermittedToView.length){delete h.usersPermittedToView}h.updateGroupsPermittedToView=true;h.groupsPermittedToView=i(m);if(!h.groupsPermittedToView.length){delete h.groupsPermittedToView}}var n=e(".edit-permissions",o);if(n.length){h.updateUsersPermittedToEdit=true;h.usersPermittedToEdit=j(n);if(!h.usersPermittedToEdit.length){delete h.usersPermittedToEdit}h.updateGroupsPermittedToEdit=true;h.groupsPermittedToEdit=i(n);if(!h.groupsPermittedToEdit.length){delete h.groupsPermittedToEdit}}if(l.calendarPlugin.getParameter(l.calendarDiv,"include")){h.include=l.calendarPlugin.getParameter(l.calendarDiv,"include")}if(!l.calendarPlugin.isProcessingSubCalendar(l.calendarDiv)){var g=l.calendarPlugin.setSubCalendarSpinnerIconVisible(true);e.ajax({cache:false,converters:{"text json":function(p){return p}},data:h,dataType:"json",dataFilter:function(p){var q=e.parseJSON(p);if(q.success){l.calendarPlugin.mergeSubCalendarObjectsToArray(q.payload)}return q},error:function(p,r,q){l.calendarPlugin.showAjaxError(l.calendarDiv,p,r,q,l.calendarPlugin.ERROR_CLASS_SUB_CALENDAR_UPDATE);l.calendarPlugin.setProcessingSubCalendar(l.calendarDiv,false)},success:function(p){l.calendarCache.removeCalendar(l.subCalendar.id);l.calendarPlugin.setGenericErrors(l.calendarDiv,null,l.calendarPlugin.ERROR_CLASS_SUB_CALENDAR_UPDATE);l.calendarPlugin.setSubCalendars(l.calendarDiv,p.payload);l.calendarPlugin.updateAvailableSubCalendarsInSubCalendarPanel(l.calendarDiv);l.calendarPlugin.setProcessingSubCalendar(l.calendarDiv,false);k.hide()},complete:function(){if(g){g.resolve()}},type:"PUT",timeout:l.calendarPlugin.ajaxTimeout,url:l.calendarPlugin.getCalendarServiceBaseUrl(l.calendarDiv,"/subcalendars/restrictions.json")})}return false},_showHideHint:function(h){var g=e(".permission-table",h);var i=e(".permitted-entities",g);if(e(".permitted-entity",i).length){h.addClass("has-restrictions");g.removeClass("hidden")}else{h.removeClass("has-restrictions");g.addClass("hidden")}},_getRestrictionGroup:function(g){return e("input[name='restriction-type']:checked",g).val()==="view"?e(".view-permissions",g):e(".edit-permissions",g)},_addUsersToPermissionFieldGroup:function(l,n,h){var g=this;var j=g._getRestrictionGroup(l);var k=e(".permitted-entities",j);var m=function(o){return e(".permitted-entity",k).filter(function(){var p=e(this).data("entity");return e.isPlainObject(p)&&p.id===o.id}).length};var i;if(e.isPlainObject(n)){i=[n]}else{if(e.isArray(n)){i=n}}if(e.isArray(i)){e.each(i,function(p,o){if(!m(o)){var q=e(document.createElement("tr")).addClass("permitted-entity").append(e(document.createElement("td")).append(e(document.createElement("img")).attr("src",o.avatarUrl)).append(e(document.createElement("span")).text(o.fullName).append(e(document.createElement("span")).addClass("user-name").text("("+o.name+")")))).append(e(document.createElement("td")).addClass("delete-permitted-entity").append(e(document.createElement("a")).addClass("remove").attr("href","#").attr("title","Delete").text("Delete").click(function(){e(this).closest("tr").remove();g._showHideHint(j);return false}))).data("entity",o);if(h){q.prependTo(k)}else{k.append(q)}}});e(".error",l).empty()}g._showHideHint(j)},_addGroupsToPermissionFieldGroup:function(j,s,o,k){var m=this;var h=m._getRestrictionGroup(j),n=e(".permitted-entities",h),p=function(t){return e(".permitted-entity",n).filter(function(){var u=e(this).data("entity");return(typeof u==="string")&&u===t}).length},r=function(t){if(Confluence.TeamCalendars.isPDLEnabled()){return e("<td/>").append(e("<span/>",{"class":"group",text:t}))}else{return e("<td/>").append(e("<img/>",{src:Confluence.getBaseUrl()+"/images/icons/group_16.gif"})).append(e("<span/>",{text:t}))}};if(s.length){var g=function(t){e.each(t,function(u,w){w=e.trim(w);if(w&&!p(w)){var v=e(document.createElement("tr")).addClass("permitted-entity").append(r(w)).append(e(document.createElement("td")).addClass("delete-permitted-entity").append(e(document.createElement("a")).addClass("remove").attr("href","#").attr("title","Delete").text("Delete").click(function(){e(this).closest("tr").remove();m._showHideHint(h);return false}))).data("entity",w);if(k){v.prependTo(n)}else{n.append(v)}}})};var i=e(".error",j);if(o){var l;var q;e.ajax({cache:false,data:{groupNames:e.map(s,function(t){return e.trim(t)})},dataType:"json",success:function(t){l=t;q=e.map(s,function(u){return e.inArray(e.trim(u),l)===-1?e.trim(u):null});g(l);i.empty();if(q.length){i.text(AJS.format("Invalid group names(s) specified: {0}",q.join(", ")))}m._showHideHint(h)},type:"GET",timeout:m.calendarPlugin.ajaxTimeout,url:m.calendarPlugin.getCalendarServiceBaseUrl(m.calendarDiv,"/util/validate/group.json")})}else{i.empty();g(s);m._showHideHint(h)}}}});return d});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-edit', location = 'com/atlassian/confluence/extra/calendar3/components/calendar-edit-dialog/calendar-edit-dialog.js' */
define("tc/calendar-edit-dialog",["jquery","underscore","tc-backbone","tc/calendar-util","tc/util","tc/myCalendarTour","tc/eventtypes-edit-dialog","tc/calendar-restriction-dialog","tc/calendar-share-dialog","tc/calendar-ical-address-dialog"],function(d,k,j,g,i,h,b,f,a,e){var c=j.View.extend({subCalendarType:null,editForm:null,subCalendarTypeObj:null,editDialog:null,subCalendar:null,callbackHandler:null,submitButton:null,eventTypesEditDialogView:null,shareCalendarDialogView:null,calendarIcalAddressDialog:null,calendarDiv:null,calendarPlugin:null,calendarCache:null,restrictionDialog:null,initialize:function(l){this.options=d.extend({},this.defaults,l);if(!this.options.subCalendar){AJS.debug("tc/eventtypes-edit-dialog: requires 'subCalendar' object")}if(!this.options.callbackHandler){AJS.debug("tc/eventtypes-edit-dialog: requires 'callbackHandler' object")}this.callbackHandler=this.options.callbackHandler;this.subCalendar=this.options.subCalendar;this.subCalendarType=(typeof this.subCalendar==="string")?this.subCalendar:this.subCalendar.type;this.subCalendarTypeObj=Confluence.TeamCalendars.subcalendar[this.subCalendarType];this.calendarDiv=l.calendarDiv;this.calendarPlugin=l.calendarPlugin;this.calendarCache=l.calendarCache},render:function(){this._editCalendarDialog();if(g.isInternalSubscriptionSubCalendar(this.subCalendar)&&g.isJiraSubCalendar(this.subCalendar)){return this.editDialog}this.eventTypesEditDialogView=new b({editDialog:this.editDialog,subCalendar:this.subCalendar,callbackHandler:this.callbackHandler});this.eventTypesEditDialogView.render();this.restrictionDialog=new f({editDialog:this.editDialog,calendarPlugin:this.calendarPlugin,calendarDiv:this.calendarDiv,subCalendar:this.subCalendar,calendarCache:this.calendarCache});this.restrictionDialog.render();this.shareCalendarDialogView=new a({editDialog:this.editDialog,subCalendar:this.subCalendar,calendarPlugin:this.calendarPlugin,calendarDiv:this.calendarDiv});this.shareCalendarDialogView.render();this.calendarIcalAddressDialog=new e({editDialog:this.editDialog,subCalendar:this.subCalendar,calendarPlugin:this.calendarPlugin,calendarDiv:this.calendarDiv});this.calendarIcalAddressDialog.render();return this.editDialog},showRestrictionOption:function(){this.editDialog.gotoPanel(g.panelEditCalendar.RESTRICTION_PANEL)},showShareOption:function(){this.editDialog.gotoPanel(g.panelEditCalendar.SHARE_EMBEDDED_PANEL)},showSubscriptionOption:function(){this.editDialog.gotoPanel(g.panelEditCalendar.SUBSCRIBE_PANEL)},selectCustomEvent:function(l){this.editDialog.gotoPanel(g.panelEditCalendar.EVENT_TYPE_PANEL);this.eventTypesEditDialogView.selectCustomEvent(l)},showAddEventTypeForm:function(){this.editDialog.gotoPanel(g.panelEditCalendar.EVENT_TYPE_PANEL);this.eventTypesEditDialogView.showAddEventypeForm()},_editCalendarDialog:function(){var l=this;l.editDialog=new AJS.ConfluenceDialog({width:l.subCalendarTypeObj.dialogWidth||630,height:l.subCalendarTypeObj.dialogHeight||537,onSubmit:function(){l.editForm.submit();return false},onCancel:function(){l._callBackCancel(l.editDialog,l.callbackHandler);l.editDialog.remove()},id:"edit-calendar-dialog"});l.subCalendarTypeHandler=l.subCalendarTypeObj.getDialog(l.editDialog,d.isPlainObject(l.subCalendar)?l.subCalendar:null,l.callbackHandler);l.editDialog.popup.element.css("overflow","visible");l.editForm=l.subCalendarTypeHandler.initializeForm(k.bind(l._callBackCancel,l,l.editDialog,l.callbackHandler));l.submitButton=l.editDialog.popup.element.find(".submit");l.editForm.submit(function(){if(l.editDialog.getCurrentPanel()!==undefined){if(l.editDialog.getCurrentPanel().id===g.panelEditCalendar.GENERAL_PANEL){return l._submitCalendarEdit(l.callbackHandler,l.subCalendarTypeHandler,l.editDialog,l.editForm,l.subCalendarTypeObj)}else{if(l.editDialog.getCurrentPanel().id===g.panelEditCalendar.EVENT_TYPE_PANEL){var o=l.editDialog.getCurrentPanel().body;var n=d("form.sub-calendar-edit-event-types-form",o);var m=d("#edit-custom-event-type-form",n);if(d(m).length){d(m).find(".tooltip-warning").removeClass("hidden");d(o).scrollTop(d(m).find("form.form-add-custom").position().top);d(m).find(".custom-event-title input").focus();return false}return l._submitEventTypesEdit(n,l.editDialog,l.callbackHandler,l.subCalendarTypeHandler,l.submitButton)}else{if(l.editDialog.getCurrentPanel().id===g.panelEditCalendar.RESTRICTION_PANEL){return l._submitRestrictionEdit(l.editDialog)}}}}})},_submitCalendarEdit:function(n,o,r,t,w){if(n.isProcessingSubCalendar()){return false}n.setProcessingSubCalendar(true);var l=n.setSubCalendarSpinnerIconVisible(true);o.onSubmitStart();var p=o.getFormDataAsAjaxData();if(n.getIncludedCalendars()){p.include=n.getIncludedCalendars()}var q=p.subCalendarId;var y=p.spaceKey;var s=p.viewingSpaceKey;var v=this.subCalendar.spaceKey;var m=this.calendarPlugin;var x=this.calendarDiv;var u=this.subCalendar.childSubCalendars;d.ajax({cache:false,converters:{"text json":function(z){return z}},data:p,dataFilter:function(z){var A=d.parseJSON(z);if(A.success){g.mergeSubCalendarObjectsToArray(A.payload)}return A},dataType:"json",error:function(z,B,A){n.showAjaxUpdateError(z,B,A);o.onSubmitEnd();n.setProcessingSubCalendar(false)},success:function(z){n.setGenericUpdateError();if(z.success){g.setFieldErrors(t,null);if((y!==v)&&(s!=="")){q=z.modifiedSubCalendarId;d("input[name='subCalendarId']",t).val(q);m.removeSubCalendarEventSource(x,q);m.removeSubCalendarEventSource(x,u);n.setSubCalendars(q,z.payload)}else{if(q){n.setSubCalendars(q,z.payload);n.reloadSubCalendar(q)}else{q=z.modifiedSubCalendarId;d("input[name='subCalendarId']",t).val(q);n.setSubCalendars(q,z.payload)}}n.refreshCalendarInfo(z.payload);n.updateAvailableSubCalendarsInSubCalendarPanel();o.onSubmitEnd();r.remove()}else{g.setFieldErrors(t,z.fieldErrors);o.onSubmitEnd();if(!w.dynamicDialogHeight){i.showDialogInUpdatedHeight(r)}}n.setProcessingSubCalendar(false)},complete:function(){if(l){l.resolve()}},type:"PUT",timeout:g.ajaxTimeout,url:g.getCalendarServiceBaseUrl("/subcalendars.json")});return false},_submitEventTypesEdit:function(m,r,p,l,q){var o=this._getEventTypeData(m);var s=o.subCalendarId;var n=p.setSubCalendarSpinnerIconVisible(true);d(q).text("Updating...").attr("disabled","disabled").addClass("ui-state-disabled");d.ajax({cache:false,converters:{"text json":function(t){return t}},data:o,dataFilter:function(t){var u=d.parseJSON(t);if(u.success){g.mergeSubCalendarObjectsToArray(u.payload)}return u},dataType:"json",error:function(t,v,u){p.showAjaxUpdateError(t,v,u);l.onSubmitEnd();d(q).text("OK").removeAttr("disabled").removeClass("ui-state-disabled");AJS.trigger("remove-dialog-edit-event.teamcalendar")},success:function(t){if(t.success){if(s){p.setSubCalendar(s,t.payload);p.reloadSubCalendar(s)}p.updateAvailableSubCalendarsInSubCalendarPanel();l.onSubmitEnd();r.remove();AJS.trigger("show-dialog-edit-event.teamcalendar")}},complete:function(){if(n){n.resolve()}},type:"PUT",timeout:g.ajaxTimeout,url:g.getCalendarServiceBaseUrl("/eventtype/disable.json")});return false},_getEventTypeData:function(l){var m=this.eventTypesEditDialogView.getDisableEventTypes();return{subCalendarId:d("input[name='subCalendarId']",l).val(),disableEventTypes:m}},_callBackCancel:function(n,m){if(this.CalendarTour){this.CalendarTour.start()}var l=m.setSubCalendarSpinnerIconVisible(true);var o=d("input[name='subCalendarId']",n.getCurrentPanel().body).val();d.ajax({cache:false,converters:{"text json":function(p){return p}},data:{subCalendarId:o},dataFilter:function(p){var q=d.parseJSON(p);if(q.success){g.mergeSubCalendarObjectsToArray(q.payload)}return q},dataType:"json",error:function(p,r,q){m.showAjaxUpdateError(p,r,q)},success:function(p){if(p.success){if(o&&p.payload&&p.payload.length){d.each(p.payload,function(q,r){if(r.id===o){m.setSubCalendar(o,r);m.reloadSubCalendar(o)}})}m.updateAvailableSubCalendarsInSubCalendarPanel();AJS.trigger("show-dialog-edit-event.teamcalendar")}},complete:function(){l.resolve()},type:"GET",timeout:g.ajaxTimeout,url:g.getCalendarServiceBaseUrl("/subcalendars.json")})},_submitRestrictionEdit:function(l){this.restrictionDialog.submitRestrictionsDialog(l);return false}});return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-edit', location = 'com/atlassian/confluence/extra/calendar3/components/calendar-edit-dialog/calendar-edit-dialog-compat.js' */
require(["tc/calendar-edit-dialog"],function(a){if(!Confluence.TeamCalendars.Dialogs){Confluence.TeamCalendars.Dialogs={}}Confluence.TeamCalendars.Dialogs.getSubCalendarEditDialog=function(d,c,f,e,b){return new a({subCalendar:d,callbackHandler:c,calendarDiv:f,calendarPlugin:e,calendarCache:b})}});
}catch(e){WRMCB(e)};